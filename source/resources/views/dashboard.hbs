<div class="container mt-5">
  <h2 class="mb-4 text-primary">üéõÔ∏è B·∫£ng qu·∫£n tr·ªã</h2>
  <h4>ü•ò Danh s√°ch b√†i vi·∫øt:</h4>
  <ul class="list-group mb-4">
    {{#each dishes}}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>{{this.name}}</strong> ‚Äî ƒêƒÉng b·ªüi: {{this.userId.username}}
          ({{#ifEquals this.userId.role 'admin'}}Admin{{else ifEquals this.userId.role 'moderator'}}Moderator {{else}}Th√†nh vi√™n{{/ifEquals}})
      </div>
      <div>
        <a href="/dishes/{{this._id}}/edit" class="btn btn-sm btn-warning me-2">Ch·ªânh s·ª≠a</a>
        <form action="/admin/{{this._id}}?_method=DELETE" method="POST" class="d-inline delete-form">
          <button type="button" class="btn btn-sm btn-danger btn-delete" data-username="{{this.userId.username}}">Xo√°</button>
        </form>
      </div>
    </li>
  {{/each}}
  </ul>

  <h2 class="mt-5">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
  <div class="table-responsive">
    <table class="table table-striped text-center align-middle">
      <thead>
        <tr>
          <th>T√™n ng∆∞·ªùi d√πng</th>
          <th>Email</th>
          <th>Vai tr√≤</th>
          <th>Tr·∫°ng th√°i</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{#each users}}
          <tr>
            <td >{{this.username}}</td>
            <td>{{this.email}}</td>
            <td>
              {{#ifEquals this.role "admin"}}
                <span class="badge bg-danger" style="font-size: 13px; padding: 12px 33px;">Admin</span>
              {{else ifEquals this.role "moderator"}}
                <span class="badge bg-warning" style="font-size: 13px; padding: 12px 20px;">Moderator</span>
              {{else}}
                <span class="badge bg-primary" style="font-size: 13px; padding: 12px 20px;">Th√†nh vi√™n</span>
              {{/ifEquals}}
            </td>
            <td>
              {{#if this.isLocked}}
                <span class="badge bg-danger" style="font-size: 13px; padding: 12px 20px">ƒê√£ kho√°</span>
              {{else}}
                <span class="badge bg-success" style="font-size: 13px; padding: 12px 20px">ƒêang ho·∫°t ƒë·ªông</span>
              {{/if}}
            </td>
            <td>
              <a href="/admin/user/{{this._id}}/info" class="btn btn-warning">
                <i class="fa-solid fa-circle-info"></i> Xem th√¥ng tin
              </a>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
    <a href="/profile" class="btn btn-back"><i class="fa-solid fa-left-long"></i> Quay v·ªÅ</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      {{#if message}}
        Swal.fire({
          icon: '{{message.type}}',
          title: '{{#ifEquals message.type "error"}}L·ªói{{else}}Th√¥ng b√°o{{/ifEquals}}',
          text: '{{message.text}}',
          confirmButtonText: 'ƒê·ªìng √Ω'
        });
      {{/if}}
    });
    document.querySelectorAll('.btn-delete').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const form = btn.closest('form');
        const username = btn.getAttribute('data-username') || '';
        Swal.fire({
          title: 'B·∫°n c√≥ ch·∫Øc mu·ªën xo√°?',
          text: `B·∫°n mu·ªën xo√° b√†i vi·∫øt c·ªßa ${username}?`,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: 'Xo√°',
          cancelButtonText: 'Hu·ª∑'
        }).then((result) => {
          if (result.isConfirmed) {
            form.submit();
          }
        });
      });
    });
    document.querySelectorAll('.btn-lock, .btn-unlock').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const form = btn.closest('form');
        const username = btn.getAttribute('data-username') || '';
        const isUnlock = btn.classList.contains('btn-unlock');
          Swal.fire({
            title: isUnlock ? 'M·ªü kho√° t√†i kho·∫£n?' : 'Kho√° t√†i kho·∫£n?',
            text: isUnlock 
              ? `B·∫°n c√≥ mu·ªën m·ªü kho√° t√†i kho·∫£n c·ªßa ${username}?`
              : `B·∫°n c√≥ mu·ªën kho√° t√†i kho·∫£n c·ªßa ${username}?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: isUnlock ? '#28a745' : '#f39c12',
            cancelButtonColor: '#3085d6',
            confirmButtonText: isUnlock ? 'M·ªü kho√°' : 'Kho√°',
            cancelButtonText: 'Hu·ª∑'
          })
          .then((result) => {
            if (result.isConfirmed) {
              form.submit();
            }
        });
      });
    });
  </script>


</div>

