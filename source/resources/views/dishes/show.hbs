
<div class="container mt-5">
    <div class="row">
        <!-- C·ªôt th√¥ng tin b√™n tr√°i -->
        <div class="col-md-4 mb-3">
            {{#if dish.imageUrl}}
            <img src="{{dish.imageUrl}}" alt="{{dish.name}}" class="img-fluid rounded shadow">
            {{/if}}

            <ul class="list-group mt-5">
                <li class="list-group-item"><strong>‚è± Duration:</strong> {{dish.time}}</li>
                <li class="list-group-item"><strong>üéØ Tr√¨nh ƒë·ªô:</strong> {{dish.level}}</li>
                <li class="list-group-item"><strong>‚úçÔ∏è T√°c gi·∫£:</strong> {{dish.userId.username}}</li>
                <li class="list-group-item"><strong>üëë Vai tr√≤:</strong>
                {{#ifEquals dish.userId.role 'admin'}}Admin{{else}}Th√†nh vi√™n{{/ifEquals}}</li>
            </ul>
            
            
        </div>

        <!-- C·ªôt n·ªôi dung ch√≠nh -->
        <div class="col-md-8">
            <h2 class="text-primary">{{dish.name}}</h2>

            {{#if dish.videoId}}
                <div class="col-lg-9">
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/{{dish.videoId}}?si=5yhRCasHauNwjnsM" title="YouTube video player" frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                </div>
            {{/if}}

            {{#if dish.description}}
                <h5 class="text-secondary">üìù M√¥ t·∫£</h5>
                <p>{{dish.description}}</p>
            {{/if}}

            {{#if dish.ingredients}}
                <h5 class="text-secondary"> üõí Nguy√™n li·ªáu</h5>
                <div>
                    {{{dish.ingredients}}}
                </div>
            {{/if}}

            {{#if dish.steps}}
                <h5 class="text-secondary">üë®‚Äçüç≥ C√°c b∆∞·ªõc th·ª±c hi·ªán</h5>
                <div>
                    {{{dish.steps}}}
                </div>
            {{/if}}

            <!-- Swiper ch√≠nh: ·∫¢nh l·ªõn -->
            <div class="swiper swiper-main">
            <div class="swiper-wrapper">
                {{#each dish.expImages}}
                    <div class="swiper-slide">
                        <img src="{{this}}" alt="Step Image">
                    </div>
                {{/each}}
            </div>
            </div>

            <!-- Swiper ph·ª•: Thumbnail -->
            <div class="swiper swiper-thumbs">
            <div class="swiper-wrapper">
                {{#each dish.expImages}}
                    <div class="swiper-slide">
                        <img src="{{this}}" alt="Step Thumbnail">
                    </div>
                {{/each}}
            </div>
            </div>

            <!-- SwiperJS -->
            {{#if dish.tips}}
                <h5 class="text-secondary">üí° M·∫πo nh·ªè</h5>
                <p>{{dish.tips}}</p>
            {{/if}}
        </div>
    </div>
</div>
<div class="mt-5">
    <!-- Khung ch·ª©a t·∫•t c·∫£ b√¨nh lu·∫≠n -->
    <div class="card mb-3">
        <h5 class="mt-4 p-2" style="margin-left: 20px; color:rgb(0, 18, 136)" > B√¨nh lu·∫≠n</h5>
        <div class="card-body">
        <!-- Danh s√°ch b√¨nh lu·∫≠n -->
            <div id="comment-list" class="mb-3">
                {{#if dish.comments.length}}
                {{#each dish.comments}}
                    <div class="border-bottom p-2 mb-2 comment-item" data-comment-id="{{this._id}}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="comment-content">
                                <strong>{{this.username}}:</strong> {{this.content}} <br>
                                <small class="text-muted">{{formatDate this.createdAt}}</small>
                            </div>
                        </div>
                    </div>
                {{/each}}
                {{else}}
                <div class="text-center text-muted py-3">
                    <i class="fa-regular fa-comment-dots mb-2" style="font-size: 2rem;"></i>
                    <p>Ch∆∞a c√≥ b√¨nh lu·∫≠n v·ªÅ b√†i vi·∫øt n√†y</p>
                </div>
                {{/if}}
            </div>
            <form id="comment-form">
                <div class="mb-3">
                <textarea class="form-control" id="comment-content" rows="2" placeholder="Nh·∫≠p b√¨nh lu·∫≠n c·ªßa b·∫°n..."></textarea>
                </div>
                <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">G·ª≠i b√¨nh lu·∫≠n</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
  .comment-content {
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-word;
    max-width: 100%;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>

<script>
    const thumbSwiper = new Swiper('.swiper-thumbs', {
    spaceBetween: 10,
    slidesPerView: 4,
    freeMode: true,
    watchSlidesProgress: true,
    });

    const mainSwiper = new Swiper('.swiper-main', {
    spaceBetween: 10,
    thumbs: {
        swiper: thumbSwiper,
    },
    });

    document.getElementById('comment-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const content = document.getElementById('comment-content').value.trim();
    if (!content) return;

    try {
        const res = await fetch(window.location.pathname + '/comments', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ content })
        });

        const data = await res.json();
        if (data.success) {
        const list = document.getElementById('comment-list');
        
        // X√≥a th√¥ng b√°o "Ch∆∞a c√≥ b√¨nh lu·∫≠n" n·∫øu c√≥
        if (list.querySelector('.text-muted.py-3')) {
            list.innerHTML = '';
        }
        
        // Th√™m comment m·ªõi v√†o ƒë·∫ßu danh s√°ch
        const newComment = document.createElement('div');
        newComment.className = 'border-bottom p-2 mb-2';
        newComment.innerHTML = `<strong>${data.comment.username}:</strong> ${data.comment.content}<br>
            <small class="text-muted">V·ª´a xong</small>`;
        list.prepend(newComment);
        
        // X√≥a n·ªôi dung ƒë√£ nh·∫≠p
        document.getElementById('comment-content').value = '';
        } else {
        alert(data.message || 'Kh√¥ng g·ª≠i ƒë∆∞·ª£c b√¨nh lu·∫≠n');
        }
    } catch (error) {
        console.error('L·ªói khi g·ª≠i b√¨nh lu·∫≠n:', error);
        alert('C√≥ l·ªói x·∫£y ra khi g·ª≠i b√¨nh lu·∫≠n');
    }

    });
</script>



